#include "twilight_2d.h"

// Constructor: Steal these values from the problem setup header.
Twilight::Twilight(const ProblemSetup& setup):
	type(setup.twilightType),
	kx(setup.kx),
	x0(setup.x0),
	ky(setup.ky),
	y0(setup.y0),
	kt(setup.kt),
	t0(setup.t0)
	{
		int i;
		for(i=0;i<5;i++){
			cx[i] = setup.cx[i];
			cy[i] = setup.cy[i];
			ct[i] = setup.ct[i];
		}
	}


/* This routine provides the value of 
		d^s/dx^s[sin(kx*x + x0)]
   for s=dx and a spatial location x. The values kx,x0 
   are defined in the problem_setup header.
*/
double Twilight::trigTwilight(const int dx, const double x,
							  const int dy, const double y,
							  const int dt, const double t){

	double t2,t3,t4,t5,t6,t7,t8,t9,t10,t11;
	double t12,t13,t14,t15,t16,t17,t18,t19;
	double kx,x0,ky,y0,kt,t0;
	double A0[5][5][5];

	kx = (*this).kx;
	x0 = (*this).x0;
	ky = (*this).ky;
	y0 = (*this).y0;
	kt = (*this).kt;
	t0 = (*this).t0;
	t2 = kt*t;
	t3 = t0+t2;
	t4 = kx*x;
	t5 = t4+x0;
	t6 = sin(t5);
	t7 = ky*y;
	t8 = t7+y0;
	t9 = sin(t8);
	t10 = sin(t3);
	t11 = kt*kt;
	t12 = cos(t3);
	t13 = cos(t8);
	t14 = t11*t11;
	t15 = ky*ky;
	t16 = t15*t15;
	t17 = cos(t5);
	t18 = kx*kx;
	t19 = t18*t18;
	A0[0][0][0] = t6*t9*t10;
	A0[0][0][1] = kt*t6*t9*t12;
	A0[0][0][2] = -t6*t9*t10*t11;
	A0[0][0][3] = -kt*t6*t9*t11*t12;
	A0[0][0][4] = t6*t9*t10*t14;
	A0[0][1][0] = ky*t6*t10*t13;
	A0[0][1][1] = kt*ky*t6*t12*t13;
	A0[0][1][2] = -ky*t6*t10*t11*t13;
	A0[0][1][3] = -kt*ky*t6*t11*t12*t13;
	A0[0][1][4] = ky*t6*t10*t13*t14;
	A0[0][2][0] = -t6*t9*t10*t15;
	A0[0][2][1] = -kt*t6*t9*t12*t15;
	A0[0][2][2] = t6*t9*t10*t11*t15;
	A0[0][2][3] = kt*t6*t9*t11*t12*t15;
	A0[0][2][4] = -t6*t9*t10*t14*t15;
	A0[0][3][0] = -ky*t6*t10*t13*t15;
	A0[0][3][1] = -kt*ky*t6*t12*t13*t15;
	A0[0][3][2] = ky*t6*t10*t11*t13*t15;
	A0[0][3][3] = kt*ky*t6*t11*t12*t13*t15;
	A0[0][3][4] = -ky*t6*t10*t13*t14*t15;
	A0[0][4][0] = t6*t9*t10*t16;
	A0[0][4][1] = kt*t6*t9*t12*t16;
	A0[0][4][2] = -t6*t9*t10*t11*t16;
	A0[0][4][3] = -kt*t6*t9*t11*t12*t16;
	A0[0][4][4] = t6*t9*t10*t14*t16;
	A0[1][0][0] = kx*t9*t10*t17;
	A0[1][0][1] = kt*kx*t9*t12*t17;
	A0[1][0][2] = -kx*t9*t10*t11*t17;
	A0[1][0][3] = -kt*kx*t9*t11*t12*t17;
	A0[1][0][4] = kx*t9*t10*t14*t17;
	A0[1][1][0] = kx*ky*t10*t13*t17;
	A0[1][1][1] = kt*kx*ky*t12*t13*t17;
	A0[1][1][2] = -kx*ky*t10*t11*t13*t17;
	A0[1][1][3] = -kt*kx*ky*t11*t12*t13*t17;
	A0[1][1][4] = kx*ky*t10*t13*t14*t17;
	A0[1][2][0] = -kx*t9*t10*t15*t17;
	A0[1][2][1] = -kt*kx*t9*t12*t15*t17;
	A0[1][2][2] = kx*t9*t10*t11*t15*t17;
	A0[1][2][3] = kt*kx*t9*t11*t12*t15*t17;
	A0[1][2][4] = -kx*t9*t10*t14*t15*t17;
	A0[1][3][0] = -kx*ky*t10*t13*t15*t17;
	A0[1][3][1] = -kt*kx*ky*t12*t13*t15*t17;
	A0[1][3][2] = kx*ky*t10*t11*t13*t15*t17;
	A0[1][3][3] = kt*kx*ky*t11*t12*t13*t15*t17;
	A0[1][3][4] = -kx*ky*t10*t13*t14*t15*t17;
	A0[1][4][0] = kx*t9*t10*t16*t17;
	A0[1][4][1] = kt*kx*t9*t12*t16*t17;
	A0[1][4][2] = -kx*t9*t10*t11*t16*t17;
	A0[1][4][3] = -kt*kx*t9*t11*t12*t16*t17;
	A0[1][4][4] = kx*t9*t10*t14*t16*t17;
	A0[2][0][0] = -t6*t9*t10*t18;
	A0[2][0][1] = -kt*t6*t9*t12*t18;
	A0[2][0][2] = t6*t9*t10*t11*t18;
	A0[2][0][3] = kt*t6*t9*t11*t12*t18;
	A0[2][0][4] = -t6*t9*t10*t14*t18;
	A0[2][1][0] = -ky*t6*t10*t13*t18;
	A0[2][1][1] = -kt*ky*t6*t12*t13*t18;
	A0[2][1][2] = ky*t6*t10*t11*t13*t18;
	A0[2][1][3] = kt*ky*t6*t11*t12*t13*t18;
	A0[2][1][4] = -ky*t6*t10*t13*t14*t18;
	A0[2][2][0] = t6*t9*t10*t15*t18;
	A0[2][2][1] = kt*t6*t9*t12*t15*t18;
	A0[2][2][2] = -t6*t9*t10*t11*t15*t18;
	A0[2][2][3] = -kt*t6*t9*t11*t12*t15*t18;
	A0[2][2][4] = t6*t9*t10*t14*t15*t18;
	A0[2][3][0] = ky*t6*t10*t13*t15*t18;
	A0[2][3][1] = kt*ky*t6*t12*t13*t15*t18;
	A0[2][3][2] = -ky*t6*t10*t11*t13*t15*t18;
	A0[2][3][3] = -kt*ky*t6*t11*t12*t13*t15*t18;
	A0[2][3][4] = ky*t6*t10*t13*t14*t15*t18;
	A0[2][4][0] = -t6*t9*t10*t16*t18;
	A0[2][4][1] = -kt*t6*t9*t12*t16*t18;
	A0[2][4][2] = t6*t9*t10*t11*t16*t18;
	A0[2][4][3] = kt*t6*t9*t11*t12*t16*t18;
	A0[2][4][4] = -t6*t9*t10*t14*t16*t18;
	A0[3][0][0] = -kx*t9*t10*t17*t18;
	A0[3][0][1] = -kt*kx*t9*t12*t17*t18;
	A0[3][0][2] = kx*t9*t10*t11*t17*t18;
	A0[3][0][3] = kt*kx*t9*t11*t12*t17*t18;
	A0[3][0][4] = -kx*t9*t10*t14*t17*t18;
	A0[3][1][0] = -kx*ky*t10*t13*t17*t18;
	A0[3][1][1] = -kt*kx*ky*t12*t13*t17*t18;
	A0[3][1][2] = kx*ky*t10*t11*t13*t17*t18;
	A0[3][1][3] = kt*kx*ky*t11*t12*t13*t17*t18;
	A0[3][1][4] = -kx*ky*t10*t13*t14*t17*t18;
	A0[3][2][0] = kx*t9*t10*t15*t17*t18;
	A0[3][2][1] = kt*kx*t9*t12*t15*t17*t18;
	A0[3][2][2] = -kx*t9*t10*t11*t15*t17*t18;
	A0[3][2][3] = -kt*kx*t9*t11*t12*t15*t17*t18;
	A0[3][2][4] = kx*t9*t10*t14*t15*t17*t18;
	A0[3][3][0] = kx*ky*t10*t13*t15*t17*t18;
	A0[3][3][1] = kt*kx*ky*t12*t13*t15*t17*t18;
	A0[3][3][2] = -kx*ky*t10*t11*t13*t15*t17*t18;
	A0[3][3][3] = -kt*kx*ky*t11*t12*t13*t15*t17*t18;
	A0[3][3][4] = kx*ky*t10*t13*t14*t15*t17*t18;
	A0[3][4][0] = -kx*t9*t10*t16*t17*t18;
	A0[3][4][1] = -kt*kx*t9*t12*t16*t17*t18;
	A0[3][4][2] = kx*t9*t10*t11*t16*t17*t18;
	A0[3][4][3] = kt*kx*t9*t11*t12*t16*t17*t18;
	A0[3][4][4] = -kx*t9*t10*t14*t16*t17*t18;
	A0[4][0][0] = t6*t9*t10*t19;
	A0[4][0][1] = kt*t6*t9*t12*t19;
	A0[4][0][2] = -t6*t9*t10*t11*t19;
	A0[4][0][3] = -kt*t6*t9*t11*t12*t19;
	A0[4][0][4] = t6*t9*t10*t14*t19;
	A0[4][1][0] = ky*t6*t10*t13*t19;
	A0[4][1][1] = kt*ky*t6*t12*t13*t19;
	A0[4][1][2] = -ky*t6*t10*t11*t13*t19;
	A0[4][1][3] = -kt*ky*t6*t11*t12*t13*t19;
	A0[4][1][4] = ky*t6*t10*t13*t14*t19;
	A0[4][2][0] = -t6*t9*t10*t15*t19;
	A0[4][2][1] = -kt*t6*t9*t12*t15*t19;
	A0[4][2][2] = t6*t9*t10*t11*t15*t19;
	A0[4][2][3] = kt*t6*t9*t11*t12*t15*t19;
	A0[4][2][4] = -t6*t9*t10*t14*t15*t19;
	A0[4][3][0] = -ky*t6*t10*t13*t15*t19;
	A0[4][3][1] = -kt*ky*t6*t12*t13*t15*t19;
	A0[4][3][2] = ky*t6*t10*t11*t13*t15*t19;
	A0[4][3][3] = kt*ky*t6*t11*t12*t13*t15*t19;
	A0[4][3][4] = -ky*t6*t10*t13*t14*t15*t19;
	A0[4][4][0] = t6*t9*t10*t16*t19;
	A0[4][4][1] = kt*t6*t9*t12*t16*t19;
	A0[4][4][2] = -t6*t9*t10*t11*t16*t19;
	A0[4][4][3] = -kt*t6*t9*t11*t12*t16*t19;
	A0[4][4][4] = t6*t9*t10*t14*t16*t19;

	return A0[dx][dy][dt];
}

double Twilight::polyTwilight(const int dx, const double x,
							  const int dy, const double y,
							  const int dt, const double t){

	double t2,t3,t4,t5,t6,t7,t8,t9,t10,t11;
	double t12,t13,t14,t15,t16,t17,t18,t19;
	double t20,t21,t22,t23,t24,t25,t26,t27,t28,t29;
	double t30,t31,t32,t33,t34,t35,t36,t37,t38,t39;
	double t40,t41,t42,t43,t44,t45,t46,t47,t48,t49;
	double t50,t51,t52,t53,t54,t55;


	double cx0,cx1,cx2,cx3,cx4;
	double cy0,cy1,cy2,cy3,cy4;
	double ct0,ct1,ct2,ct3,ct4;

	double A0[5][5][5];

	cx0 = (*this).cx[0];
	cx1 = (*this).cx[1];
	cx2 = (*this).cx[2];
	cx3 = (*this).cx[3];
	cx4 = (*this).cx[4];
	cy0 = (*this).cy[0];
	cy1 = (*this).cy[1];
	cy2 = (*this).cy[2];
	cy3 = (*this).cy[3];
	cy4 = (*this).cy[4];
	ct0 = (*this).ct[0];
	ct1 = (*this).ct[1];
	ct2 = (*this).ct[2];
	ct3 = (*this).ct[3];
	ct4 = (*this).ct[4];

	t2 = t*t;
	t3 = x*x;
	t4 = y*y;
	t5 = cx1*x;
	t6 = cx2*t3;
	t7 = cx3*t3*x;
	t8 = t3*t3;
	t9 = cx4*t8;
	t10 = cx0+t5+t6+t7+t9;
	t11 = cy1*y;
	t12 = cy2*t4;
	t13 = cy3*t4*y;
	t14 = t4*t4;
	t15 = cy4*t14;
	t16 = cy0+t11+t12+t13+t15;
	t17 = ct1*t;
	t18 = ct2*t2;
	t19 = ct3*t*t2;
	t20 = t2*t2;
	t21 = ct4*t20;
	t22 = ct0+t17+t18+t19+t21;
	t23 = ct2*t*2.0;
	t24 = ct3*t2*3.0;
	t25 = ct4*t*t2*4.0;
	t26 = ct1+t23+t24+t25;
	t27 = cy2*y*2.0;
	t28 = cy3*t4*3.0;
	t29 = cy4*t4*y*4.0;
	t30 = cy1+t27+t28+t29;
	t31 = ct2*2.0;
	t32 = ct3*t*6.0;
	t33 = ct4*t2*1.2E1;
	t34 = t31+t32+t33;
	t35 = ct3*6.0;
	t36 = ct4*t*2.4E1;
	t37 = t35+t36;
	t38 = cy2*2.0;
	t39 = cy3*y*6.0;
	t40 = cy4*t4*1.2E1;
	t41 = t38+t39+t40;
	t42 = cy3*6.0;
	t43 = cy4*y*2.4E1;
	t44 = t42+t43;
	t45 = cx2*x*2.0;
	t46 = cx3*t3*3.0;
	t47 = cx4*t3*x*4.0;
	t48 = cx1+t45+t46+t47;
	t49 = cx2*2.0;
	t50 = cx3*x*6.0;
	t51 = cx4*t3*1.2E1;
	t52 = t49+t50+t51;
	t53 = cx3*6.0;
	t54 = cx4*x*2.4E1;
	t55 = t53+t54;
	A0[0][0][0] = t10*t16*t22;
	A0[0][0][1] = t10*t16*t26;
	A0[0][0][2] = t10*t16*t34;
	A0[0][0][3] = t10*t16*t37;
	A0[0][0][4] = ct4*t10*t16*2.4E1;
	A0[0][1][0] = t10*t22*t30;
	A0[0][1][1] = t10*t26*t30;
	A0[0][1][2] = t10*t30*t34;
	A0[0][1][3] = t10*t30*t37;
	A0[0][1][4] = ct4*t10*t30*2.4E1;
	A0[0][2][0] = t10*t22*t41;
	A0[0][2][1] = t10*t26*t41;
	A0[0][2][2] = t10*t34*t41;
	A0[0][2][3] = t10*t37*t41;
	A0[0][2][4] = ct4*t10*t41*2.4E1;
	A0[0][3][0] = t10*t22*t44;
	A0[0][3][1] = t10*t26*t44;
	A0[0][3][2] = t10*t34*t44;
	A0[0][3][3] = t10*t37*t44;
	A0[0][3][4] = ct4*t10*t44*2.4E1;
	A0[0][4][0] = cy4*t10*t22*2.4E1;
	A0[0][4][1] = cy4*t10*t26*2.4E1;
	A0[0][4][2] = cy4*t10*t34*2.4E1;
	A0[0][4][3] = cy4*t10*t37*2.4E1;
	A0[0][4][4] = ct4*cy4*t10*5.76E2;
	A0[1][0][0] = t16*t22*t48;
	A0[1][0][1] = t16*t26*t48;
	A0[1][0][2] = t16*t34*t48;
	A0[1][0][3] = t16*t37*t48;
	A0[1][0][4] = ct4*t16*t48*2.4E1;
	A0[1][1][0] = t22*t30*t48;
	A0[1][1][1] = t26*t30*t48;
	A0[1][1][2] = t30*t34*t48;
	A0[1][1][3] = t30*t37*t48;
	A0[1][1][4] = ct4*t30*t48*2.4E1;
	A0[1][2][0] = t22*t41*t48;
	A0[1][2][1] = t26*t41*t48;
	A0[1][2][2] = t34*t41*t48;
	A0[1][2][3] = t37*t41*t48;
	A0[1][2][4] = ct4*t41*t48*2.4E1;
	A0[1][3][0] = t22*t44*t48;
	A0[1][3][1] = t26*t44*t48;
	A0[1][3][2] = t34*t44*t48;
	A0[1][3][3] = t37*t44*t48;
	A0[1][3][4] = ct4*t44*t48*2.4E1;
	A0[1][4][0] = cy4*t22*t48*2.4E1;
	A0[1][4][1] = cy4*t26*t48*2.4E1;
	A0[1][4][2] = cy4*t34*t48*2.4E1;
	A0[1][4][3] = cy4*t37*t48*2.4E1;
	A0[1][4][4] = ct4*cy4*t48*5.76E2;
	A0[2][0][0] = t16*t22*t52;
	A0[2][0][1] = t16*t26*t52;
	A0[2][0][2] = t16*t34*t52;
	A0[2][0][3] = t16*t37*t52;
	A0[2][0][4] = ct4*t16*t52*2.4E1;
	A0[2][1][0] = t22*t30*t52;
	A0[2][1][1] = t26*t30*t52;
	A0[2][1][2] = t30*t34*t52;
	A0[2][1][3] = t30*t37*t52;
	A0[2][1][4] = ct4*t30*t52*2.4E1;
	A0[2][2][0] = t22*t41*t52;
	A0[2][2][1] = t26*t41*t52;
	A0[2][2][2] = t34*t41*t52;
	A0[2][2][3] = t37*t41*t52;
	A0[2][2][4] = ct4*t41*t52*2.4E1;
	A0[2][3][0] = t22*t44*t52;
	A0[2][3][1] = t26*t44*t52;
	A0[2][3][2] = t34*t44*t52;
	A0[2][3][3] = t37*t44*t52;
	A0[2][3][4] = ct4*t44*t52*2.4E1;
	A0[2][4][0] = cy4*t22*t52*2.4E1;
	A0[2][4][1] = cy4*t26*t52*2.4E1;
	A0[2][4][2] = cy4*t34*t52*2.4E1;
	A0[2][4][3] = cy4*t37*t52*2.4E1;
	A0[2][4][4] = ct4*cy4*t52*5.76E2;
	A0[3][0][0] = t16*t22*t55;
	A0[3][0][1] = t16*t26*t55;
	A0[3][0][2] = t16*t34*t55;
	A0[3][0][3] = t16*t37*t55;
	A0[3][0][4] = ct4*t16*t55*2.4E1;
	A0[3][1][0] = t22*t30*t55;
	A0[3][1][1] = t26*t30*t55;
	A0[3][1][2] = t30*t34*t55;
	A0[3][1][3] = t30*t37*t55;
	A0[3][1][4] = ct4*t30*t55*2.4E1;
	A0[3][2][0] = t22*t41*t55;
	A0[3][2][1] = t26*t41*t55;
	A0[3][2][2] = t34*t41*t55;
	A0[3][2][3] = t37*t41*t55;
	A0[3][2][4] = ct4*t41*t55*2.4E1;
	A0[3][3][0] = t22*t44*t55;
	A0[3][3][1] = t26*t44*t55;
	A0[3][3][2] = t34*t44*t55;
	A0[3][3][3] = t37*t44*t55;
	A0[3][3][4] = ct4*t44*t55*2.4E1;
	A0[3][4][0] = cy4*t22*t55*2.4E1;
	A0[3][4][1] = cy4*t26*t55*2.4E1;
	A0[3][4][2] = cy4*t34*t55*2.4E1;
	A0[3][4][3] = cy4*t37*t55*2.4E1;
	A0[3][4][4] = ct4*cy4*t55*5.76E2;
	A0[4][0][0] = cx4*t16*t22*2.4E1;
	A0[4][0][1] = cx4*t16*t26*2.4E1;
	A0[4][0][2] = cx4*t16*t34*2.4E1;
	A0[4][0][3] = cx4*t16*t37*2.4E1;
	A0[4][0][4] = ct4*cx4*t16*5.76E2;
	A0[4][1][0] = cx4*t22*t30*2.4E1;
	A0[4][1][1] = cx4*t26*t30*2.4E1;
	A0[4][1][2] = cx4*t30*t34*2.4E1;
	A0[4][1][3] = cx4*t30*t37*2.4E1;
	A0[4][1][4] = ct4*cx4*t30*5.76E2;
	A0[4][2][0] = cx4*t22*t41*2.4E1;
	A0[4][2][1] = cx4*t26*t41*2.4E1;
	A0[4][2][2] = cx4*t34*t41*2.4E1;
	A0[4][2][3] = cx4*t37*t41*2.4E1;
	A0[4][2][4] = ct4*cx4*t41*5.76E2;
	A0[4][3][0] = cx4*t22*t44*2.4E1;
	A0[4][3][1] = cx4*t26*t44*2.4E1;
	A0[4][3][2] = cx4*t34*t44*2.4E1;
	A0[4][3][3] = cx4*t37*t44*2.4E1;
	A0[4][3][4] = ct4*cx4*t44*5.76E2;
	A0[4][4][0] = cx4*cy4*t22*5.76E2;
	A0[4][4][1] = cx4*cy4*t26*5.76E2;
	A0[4][4][2] = cx4*cy4*t34*5.76E2;
	A0[4][4][3] = cx4*cy4*t37*5.76E2;
	A0[4][4][4] = ct4*cx4*cy4*1.3824E4;

	return A0[dx][dy][dt];
}